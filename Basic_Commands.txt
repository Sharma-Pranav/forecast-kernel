# üì¶ Forecast-Kernel Bootstrap ‚Äî Phases 0‚Äì4 Verified

# 1Ô∏è‚É£ Activate or Create Virtual Environment
if (-not (Test-Path ".venv")) {
    Write-Host "Creating .venv with Python 3.10..."
    uv venv --python=3.10 .venv
}

# Activate Environment
. .venv\Scripts\Activate.ps1

# 2Ô∏è‚É£ Editable Package Install
Write-Host "Installing dependencies from requirements.txt..."
uv pip install -r requirements.txt

Write-Host "Installing forecastkernel in editable mode..."
pip install -e .

# 3Ô∏è‚É£ Git Identity (one-time setup)
git config --global user.name "Pranav Sharma"
git config --global user.email "pranavsharma619@gmail.com"

# 4Ô∏è‚É£ Run Data Preflight (Phase 0a)
python -m forecastkernel.scripts.data_preflight `
  --input data/raw/univariate_example.csv `
  --output preflight_report.json

# 5Ô∏è‚É£ Run Baseline Phase 1 Script
python -m forecastkernel.scripts.baseline_sf `
  --data data/raw/univariate_example.csv `
  --horizon 14 `
  --tag demo `
  --phase 1

# 6Ô∏è‚É£ Cascade from Baseline (Phase 1b)
python -m forecastkernel.scripts.cascade `
  --parent_run data/outputs/baseline/demo -- `
  --data data/raw/univariate_example.csv `
  --horizon 14 --tag cascaded

# 7Ô∏è‚É£ Validate Feature Registry (Phase 1c)
python - <<EOF
from forecastkernel.utils.feature_registry import load_features
print(load_features().get("features", {}).keys())
EOF

# 8Ô∏è‚É£ Drift & Error Decomposition Tests (Phase 2)
pytest tests/test_drift_decomposition_dm.py -q

# 9Ô∏è‚É£ Run CI Runtime Tests
python -m forecastkernel.tests.test_ci_runtime `
  --run_dir data/outputs/baseline/demo `
  --data data/raw/univariate_example.csv

# üîü Run Audit Hash Check
python -m forecastkernel.utils.ci_utils `
  --audit_log data/outputs/baseline/demo/audit_log.json `
  --output_dir data/outputs/baseline/demo

# 1Ô∏è‚É£1Ô∏è‚É£ Generate Visual Delta Audit
python -m forecastkernel.scripts.visual_delta_audit `
  --output_path data/outputs/baseline/demo

# üîÅ Optional: Regeneration + Delta Recheck
python -m forecastkernel.scripts.baseline_sf `
  --data data/raw/univariate_example.csv `
  --horizon 14 `
  --tag demo `
  --phase 4 `
  --regenerate

python -m forecastkernel.tests.test_ci_runtime `
  --run_dir data/outputs/baseline/demo `
  --data data/raw/univariate_example.csv

python -m forecastkernel.utils.ci_utils `
  --audit_log data/outputs/baseline/demo/audit_log.json `
  --output_dir data/outputs/baseline/demo `
  --log_ci_results

python -m forecastkernel.scripts.visual_delta_audit `
  --output_path data/outputs/baseline/demo
